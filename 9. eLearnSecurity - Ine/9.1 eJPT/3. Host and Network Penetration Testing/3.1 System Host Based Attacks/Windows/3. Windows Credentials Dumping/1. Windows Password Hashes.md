
#### SAM - Security Account Manager Databases: 
Il SAM è un database che memorizza le varie password dei sistemi operativi Windows. 
Le password vengono memorizzate in hash LM, o NTLM o NTLMv2 in un hive del Registro del sisyema (%SystemRoot%/system32/config/SAM) accessibili con privilegi amministrativi.

Microsoft ha introdotto la funzione SYSKEY in Windows NT 4.0. Quando SYSKEY è abilitato, la copia su disco del file SAM è parzialmente crittografata con una chiave SYSKEY, in modo che i valori hash delle password per tutti gli account locali archiviati nel SAM siano crittografati.
Per questo solitamente vengono estratti gli hash utilizzando strade alternative come attacchi che vanno a fare il dump degli hash SAM dai processi LSASS oppure se si è in possesso della syskey, viene effettuata una copia del SAM e decryptato.
 

#### LSA - Local Security Authority 
LSA è un componente di Windows che gestisce l’autenticazione e i privilegi degli account utente e dei processi che accedono alle risorse del sistema. LSA gestisce le credenziali, inclusi i nomi utente e le password, e controlla l’accesso alle risorse di sistema come file, cartelle, stampanti e reti.


#### LSASS: Local Security Authority Subsystem Service
lsass.exeè il processo responsabile dell'applicazione della politica di sicurezza sui sistemi Windows. Quando un utente tenta di accedere al sistema, questo processo verifica il tentativo di accesso e crea token di accesso in base ai livelli di autorizzazione dell'utente (token creato dal processo winlogon.exe, e associato all'utente tramite il processo userinit.exe, che associerà il token a tutti i processi creati da quell'utenza).
LSASS è anche responsabile delle modifiche alla password dell'account utente. Tutti gli eventi associati a questo processo (tentativi di accesso/disconnessione, ecc.) vengono registrati nel registro di sicurezza di Windows. LSASS è un obiettivo di altissimo valore poiché esistono diversi strumenti per estrarre sia le credenziali in chiaro che quelle con hash archiviate in memoria da questo processo. (se sei amministratore, puoi usare Mimikatz per fare il dump dal lsaas.exe)

#### LM Hashesh
Password divisa in due chunk da 7 caratteri ognuno, tutti convertiti in maiuscolo, ogni chunk viene hashato usanto DES Facile da crackare perché non usa crack  From Windows Vista LM viene disabilitato in favore di NTLM

#### NTLMv1
Hashing della password sono salvate all'interno dei servizi SAM (Security Account Manager), è inutile usare salt, in quanto appunto da qualche parte devo salvarlo ed è facilmente recuperabile all'interno di un sistema di rete, mentre su un applicativo posso salvarlo in maniera piu indipendente e imprevedibile. 


#### Kerberos
Kerberos è il protocollo di autenticazione predefinito per gli account di dominio a partire da Windows 2000. Kerberos è uno standard aperto e consente l'interoperabilità con altri sistemi che utilizzano lo stesso standard. Quando un utente accede al proprio PC, Kerberos viene utilizzato per autenticarlo tramite autenticazione reciproca oppure sia l'utente che il server verificano la propria identità. 
Kerberos è un protocollo di autenticazione senza stato basato su ticket anziché sulla trasmissione delle password degli utenti sulla rete. Nell'ambito di Active Directory Domain Services (AD DS), i controller di dominio dispongono di un centro di distribuzione delle chiavi Kerberos (KDC) che emette ticket. Quando un utente avvia una richiesta di accesso a un sistema, il client che sta utilizzando per l'autenticazione richiede un ticket dal KDC, crittografando la richiesta con la password dell'utente. 
Se il KDC può decrittografare la richiesta (AS-REQ) utilizzando la propria password, creerà un Ticket Granting Ticket (TGT) e lo trasmetterà all'utente. 
L'utente presenta quindi il proprio TGT a un controller di dominio per richiedere un ticket TGS (Ticket Granting Service), crittografato con l'hash della password NTLM del servizio associato. Infine, il client richiede l'accesso al servizio richiesto presentando il TGS all'applicazione o al servizio, che lo decrittografa con il suo hash della password. 
Se l'intero processo viene completato in modo appropriato, all'utente sarà consentito accedere al servizio o all'applicazione richiesta. il client richiede l'accesso al servizio richiesto presentando il TGS all'applicazione o al servizio, che lo decrittografa con il suo hash della password. Se l'intero processo viene completato in modo appropriato, all'utente sarà consentito accedere al servizio o all'applicazione richiesta. il client richiede l'accesso al servizio richiesto presentando il TGS all'applicazione o al servizio, che lo decrittografa con il suo hash della password. Se l'intero processo viene completato in modo appropriato, all'utente sarà consentito accedere al servizio o all'applicazione richiesta. 

L'autenticazione Kerberos separa in modo efficace le credenziali degli utenti dalle loro richieste alle risorse utilizzabili, garantendo che la loro password non venga trasmessa sulla rete (ad esempio, accedendo a un sito intranet interno di SharePoint). Il Kerberos Key Distribution Center (KDC) non registra le transazioni precedenti. Invece, il ticket Kerberos Ticket Granting Service (TGS) si basa su un Ticket Granting Ticket (TGT) valido. Si presuppone che se l'utente dispone di un TGT valido, deve aver dimostrato la propria identità. Il diagramma seguente illustra questo processo ad alto livello.   Processo di autenticazione Kerberos 

1. L'utente accede e la sua password viene convertita in un hash NTLM, utilizzato per crittografare il ticket TGT. Ciò disaccoppia le credenziali dell'utente dalle richieste alle risorse. 

2. Il servizio KDC sul DC controlla la richiesta del servizio di autenticazione (AS-REQ), verifica le informazioni dell'utente e crea un Ticket Granting Ticket (TGT), che viene consegnato all'utente. 

3. L'utente presenta il TGT al DC, richiedendo un ticket del Ticket Granting Service (TGS) per uno specifico servizio. Questo è il TGS-REQ. Se il TGT viene convalidato con successo, i suoi dati vengono copiati per creare un ticket TGS. 

4. Il TGS viene crittografato con l'hash della password NTLM del servizio o dell'account computer nel cui contesto è in esecuzione l'istanza del servizio e viene recapitato all'utente in TGS_REP. 

5. L'utente presenta il TGS al servizio e, se è valido, all'utente è consentito connettersi alla risorsa (AP_REQ).


#### Kerberosting
Il controller di dominio risponde con un ticket di servizio criptato con la chiave segreta dell’account di servizio. L’aggressore può così inondare il server Kerberos con richieste TGS (Ticket Granting Service), estrarre i ticket dalla memoria e poi intentare un password cracking offline. L’algoritmo di hashing RC4 è ormai superato e vulnerabile: quando esso viene usato al posto di AES (vedere più avanti), il malintenzionato può estrapolare le credenziali dell’account di servizio con grande facilità (senza bisogno di generare ulteriori richieste) e ottenere accesso illimitato a tutti i sistemi e a tutte le risorse a cui l’account compromesso ha accesso. L’attaccante è a questo punto in grado di aumentare i suoi privilegi molto rapidamente e di effettuare movimenti laterali all’interno del sistema informatico dell’azienda. Kerberoasting è un attacco che può essere messo in atto nella fase post-exploitation: è cioè necessario che l’aggressore abbia già guadagnato in qualche modo l’accesso alla rete aziendale disponendo di un’utenza di dominio valida. Questo aspetto rende chiaro, ancora una volta, come il problema della sicurezza dell’infrastruttura IT vada esaminato e trattato nel suo complesso, non “a compartimenti stagni”. Mercuri evidenzia come sia potenzialmente esposta all’attacco Kerberoasting la stragrande maggioranza delle aziende, perché il 99% di esse utilizza Active Directory nella propria infrastruttura.
Se stai cercando informazioni su come visualizzare i ticket Kerberos archiviati nella cache, puoi utilizzare il comando klist in Windows 3. Il comando klist può essere utilizzato per visualizzare un elenco di ticket Kerberos attualmente archiviati nella cache. È possibile utilizzare l'opzione ticket klist per visualizzare i Ticket Granting Ticket (TGT) attualmente memorizzati nella cache e i ticket di servizio per la sessione di accesso specificata 3.


```



```