
```
Il controllo degli accessi è l'applicazione di vincoli su chi o cosa è autorizzato a eseguire azioni o accedere alle risorse. Nel contesto delle applicazioni web, il controllo degli accessi dipende dall'autenticazione e dalla gestione delle sessioni:

- L'autenticazione conferma che l'utente è chi dice di essere.
- La gestione delle sessioni identifica quali successive richieste HTTP vengono effettuate dallo stesso utente.
- Il controllo dell'accesso determina se all'utente è consentito eseguire l'azione che sta tentando di eseguire.

I controlli di accesso non funzionanti sono comuni e spesso presentano una vulnerabilità critica per la sicurezza. La progettazione e la gestione dei controlli di accesso è un problema complesso e dinamico che applica vincoli aziendali, organizzativi e legali a un'implementazione tecnica. Le decisioni sulla progettazione del controllo degli accessi devono essere prese dagli esseri umani, quindi il rischio di errori è elevato.



Differenti tipologie di controllo degli accessi:

#. Metodo di controllo di accesso basati su Parametri:
  es. ?admin=true; ?role=1

#. Controllo degli accessi interrotto a causa di errate di conf (es. URL, gruppo):
- DENY: POST, /admin/deleteUser, managers
Questa regola nega l'accesso a POST metodo sull'URL /admin/deleteUser, per gli utenti del gruppo manager. Varie cose possono andare storte in questa situazione, portando a bypassare il controllo degli accessi.
Questi controlli possono essere aggirati utilizzando "X-Original-URL" o "X-Rewrite-URL" o se il controllo è client-side modificando parametri di response che vengono memorizzati in sessione (es. "admin=true", o URL case sensitive: /ADMIN/DELETEUSER o /myaccount?id=123).


#. Parametro "id/gui" che identifica la risorsa facilmente enumerabile

# Controllo degli accessi basato sui referer:
Es. Un applicazione permette l'accesso alla pagina amministrativa principale unicamente se si proviene dall'indirizzo /admin



### Security Models - Access Control

#1. Controllo degli accessi programmatico
#2. Controllo accessi discrezionale - DAC
#3. Controllo accessi obbligatorio - MAC
#4. Controllo degli accessi basato sui ruoli - RBAC



### IDOR - Direct Object Reference:
Riferimenti diretti ad oggetti non sicuri sono una sottocategoria delle vulnerabilità del controllo degli accessi. Gli IDOR si verificano se un'applicazione utilizza l'input fornito dall'utente per accedere direttamente agli oggetti e un utente malintenzionato può modificare l'input per ottenere un accesso non autorizzato. È stato reso popolare dalla sua apparizione nella Top Ten dell'OWASP 2007. È solo un esempio dei tanti errori di implementazione che possono fornire un mezzo per aggirare i controlli di accesso. 
```





```
#General

> ?admin=true
> ?role=1

> "X-Original-URL" o "X-Rewrite-URL" 

> Se il controllo è client-side modifica parametri di response che vengono memorizzati in sessione (es. "admin=true")

> URL case sensitive: /ADMIN/DELETEUSER

> Provare a modificare GET che effettuano accesso al profilo, aggiungendo/modificando l'id:
/myaccount?id=123.
```





```
## Access Control Vulnerabilities - LAB Apprentice



#1. Funzionalità amministrative non protette:
 > "file" /robots.txt 
 Include admin panel information
 > go to "file" /administrator-panel 



#2. Funzionalità amministrative:
JavaScript that discloses the URL of the admin panel



#3. Ruolo utente controllato da request param:
Browse to /admin and observe that you can't access the admin panel.
Observe that the response sets the cookie Admin=false. Change it to Admin=true



#4. Ruolo utente non modificabile nel profilo utente:
> roleId: 2=admin - roleId: 1=normal user
> Add "roleid":2 into the JSON in the request body, and resend it. 
> Browse to /admin and delete carlos.



#5. ID utente controllato dal parametro di richiesta:
> URL contains your username in the "id" parameter. 
> Change the "id" parameter to carlos. 
> Retrieve and submit the API key for carlos.



#6. ID utente controllato dal parametro di richiesta, con ID utente imprevedibili:
> Trova un post sul blog di carlos.
> Clicca su carlose osserva che l'URL contiene il suo ID utente. Prendere nota di questo ID.
> Accedi utilizzando le credenziali fornite e accedi alla pagina del tuo account.
> Modificare il parametro "id" con l'ID utente salvato. 



#7. ID utente controllato dal parametro di richiesta con perdita di dati nel reindirizzamento:
> Cambia il parametro "id" in carlos.
> Osserva che sebbene la risposta ora ti reindirizzi alla home page, ha un corpo contenente la chiave API appartenente a carlos. 



#8. ID utente controllato dal parametro di richiesta con divulgazione della password:
> Effettua il login utilizzando le credenziali fornite e accedi alla pagina dell'account utente.
> Cambia il parametro "id" nell'URL in administrator.
> Visualizza la risposta in Burp e osserva che contiene la password dell'amministratore.



#9. IDOR:
> URL e osservare che le trascrizioni sono file di testo a cui è assegnato un nome file contenente un numero incrementale
> Cambia il nome del file che è incrementale 1.txt
```


```
## Access Control Vulnerabilities - LAB Practitioner


#10. Access Control Bypassing - Headers:
> GET /
> X-Original-URL: /admin
> x-Rewrite-URL: /admin

> GET /?username=carlos
> X-Original-URL: /admin/delete
> X-Original-URL: /admin/delete



#11. Access Control Bypassing - HTTP Method:
> Change HTTP Method from POST to GET to obtain new privileges



#12. Multi-step process with no acces control on one step:
> Copia il cookie di sessione dell'utente non amministratore nella richiesta del ripetitore esistente, modifica il nome utente con il tuo e riproducilo. 



#13. Access Control Bypassing - Referer Header:
> /admin-roles?username=carlos&action=upgrade 
Observe that the request is treated as unauthorized due to the absent Referer header
> Modify "Referer Header": in admin header



```


