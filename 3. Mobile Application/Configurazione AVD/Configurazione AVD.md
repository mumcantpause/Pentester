
```
Guida all'utilizzo dell' emulatore Android ufficiale, senza la necessità di installare Android Studio (in alternativa esiste anche Corellium, ma è a pagamento).

Utilizzando android_sdk, indipendentemente da Android Studio, risparmiando molti gigabyte di spazio.

netstat -r

ip route

Download:  
cmdline-tools (avdmanager, sdkmanager)  
platform-tools (adb)

system-images;android-29;google_apis;x86  
  
system-images;android-34;google_apis;x86_64

C:\Users\vito9\android-sdk\cmdline-tools\latest\bin> .\sdkmanager.bat --install "system-images;android-34;google_apis;x86_64"

system-images;android-29;default;x86

system-images;android-34;google_apis;x86_64

.\sdkmanager --list_installed

Create device - With avdmanager.exe

avdmanager create avd -k "system-images;android-33;google_apis;x86_64" -n "android_33"

system-images;android-33;google_apis;x86_64

Run Emulator - emulator.exe

emulator.exe -list-avds

adb.exe -s "emulator-5556" shell

emulator.exe -avd android_29 -scale 0.6 -writable-system

Options:

- Windows Features: Enable "Hyper-V" and "Windows Hypervisor Platforms"

- config.ini: C:\Users\vito9\.android\avd\android_29.avd

forceColdBoot: yes, hw.keyboard=true, hw.mainKeys=yes

- create platforms dir in /android_sdk

- create environment ANDROID_HOME

Root:

adb root

adb disable-verity

adb reboot

adb root

adb remount  
  
echo "ip nomehost" >> /etc/hosts  
  
 

adb root

adb shell avbctl disable-verification

adb reboot

adb root

adb remount

Certificato  
 

# convert burpsuite certificate from der to cer/pem/crt

openssl x509 -inform der -in burp-free.der -out burp-free.cer

# extract the hash to be used for the certificate name

openssl x509 -inform PEM -subject_hash_old -in burp-free.cer | head -1

9a5ba575

cp burp-free.cer 9a5ba575.0

# install the certificate inside the system certificate store

.\emulator.exe -avd <avd_name_here> -writable-system

.\adb.exe root

.\adb.exe disable-verity

.\adb.exe reboot

.\adb.exe root

.\adb.exe remount

.\adb.exe push 9a5ba575.0 /system/etc/security/cacerts

.\adb.exe shell chmod 644 /system/etc/security/cacerts/9a5ba575.0

.\adb.exe reboot

# or

.\emulator.exe -avd <avd_name_here> -writable-system

.\adb.exe root

.\adb.exe shell avbctl disable-verification

.\adb.exe reboot

.\adb.exe root

.\adb.exe remount

.\adb.exe push 9a5ba575.0 /system/etc/security/cacerts

.\adb.exe shell chmod 644 /system/etc/security/cacerts/9a5ba575.0

.\adb.exe reboot

# or  
adb root

Mount -o remount,rw /system  
 

mount -o remount,rw /system  
mount -o rw,remount /

echo "10.24.1.48     host"                 >> /etc/hosts

echo "10.24.1.47     host"  >> /etc/hosts

echo "10.24.9.45     host"      >> /etc/hosts  
 

  
Redirect:  
sulla windows ti conviene avere due regole di rinetd, una che windows:8080 -> kali:8080 per il burp ed una windows:5555 -> android:5555 per adb  
  
redir  
  
Port Forwarding:  
Una volta dentro, possiamo impostare le regole di port forwarding desiderate utilizzando il redir addcomando, seguito dal protocollo, dalla porta da aprire sull'host e dalla porta dell'emulatore vincolata alla regola.

Kali Nat:

eth0 192.168.118.129

GW 192.168.118.2

Host Windows

192.168.1.13

Emulatore:

eth0: 10.0.2.15/24

lo:   127.0.0.1

Ha un telnet accessibile dal quale poter modificare le regole di redirect del "router" android  
  
Each emulator uso paire of port:  
Console: 5554  
ADB: 5555

1. Creo un port forwarding, per direazionare il traffico in arrivo sulla porta 10100 verso il mio emulatore dove apro il frida-server 10099

redir add tcp:10100:10099

2. Creo un port forwarding sull'host Windows per ridirezionare il traffico di tutte le interfacce (0.0.0.0) in arrivo sulla porta 10100 verso l'emulatore (127.0.0.1) dove è presente la regola n°1 sulla porta 10099

# netsh interface portproxy add v4tov4 listenport=10100 listenaddress=0.0.0.0 connectport=10099 connectaddress=127.0.0.1

# netstat -abnop tcp | findstr "10099"

TCP    127.0.0.1:10099        0.0.0.0:0              LISTENING       6080

# netstat -abnop tcp | findstr "10100"

 TCP    0.0.0.0:10100          0.0.0.0:0              LISTENING       3612

Dalla mia Kali nattata aprendo il mio frida client sul mio gw con porta:10100, dovrei attivare tutto il processo e connettermi al frida-server

└─# frida-ps -H 192.168.118.2:10100                             

Failed to enumerate processes: unable to connect to remote frida-server

Install on Windows:  
Install python  
  
Install pip:  
curl [https://bootstrap.pypa.io/get-pip.py](https://bootstrap.pypa.io/get-pip.py) -o get-pip.py  
  
pip install frida-tools  
  
frida-ps U  
frida-ps Ua  
 

AVD + Kali  
  
PS C:\WINDOWS\system32> netsh interface portproxy add v4tov4 listenport=8081 listenaddress=0.0.0.0 connectport=8082 connectaddress=192.168.1.4

PS C:\WINDOWS\system32> netsh interface portproxy show all

Ascolta su ipv4:             Connetti a ipv4:

Indirizzo         Porta        Indirizzo         Porta

--------------- ----------  --------------- ----------

0.0.0.0         8081        192.168.1.4     8082  
  
  
Kali in Bridge e mi metto in ascolto sulla 8082  
  
Sul Proxy del telefono  
0.0.0.0 8081  
 

String pdfium | grep -i

Oauth Account tAKEoVER BY Hijacking custom schemes

Setting VM:  
e

Also disable memory integrity from core isolation.

`Windows Security -> Device Security -> Core Isolation details`

Per riattivarlo: bcdedit /set hypervisorlaunchtype auto


```