

```

###. Android:

#. Certificate Pinning:
#. Root Detection
#. Request caching
#. Plaintext SharedPreferences (/data/data/{ID}/shared_prefs/{FILE}.xml)
#. Bypass accesso biometrico
#. WebView Debug Mode Enabled (marketwall 2021) (setWebContentsDebuggingEnabled)
#. Backup mode enabled (marketwall 2021)
#. Task hijacking
#. Missing Code Obfuscation
#. Attribute usesCleartextTraffic set to True
#. Hard-coded clear-text Cryptographic Secrets



###. IOS
#. Cert pinning
#. root detection
#. request caching
#. plaintext userDefaults (/var/mobile/Containers/Data/Application/{ID}/Library/Preferences/{FILE}.plist)
#. bypass accesso biometrico



```




```
#. Android - Depth



#. Certificate Pinning:
L'applicazione non riesce a verificare l'identità del server prima di stabilire la connessione.
Tale verifica dovrà essere eseguita confrontando il certificato fornito dal server con una copia locale inclusa nel pacchetto di installazione.
È possibile eseguire attacchi man-in-the-middle fornendo certificati personalizzati ai client. Tale configurazione consente agli aggressori di intercettare e alterare il traffico scambiato tra client e server.
Confronta il certificato del server con una copia locale prima di stabilire la connessione.

Il certificate pinning è un meccanismo di sicurezza che consente di verificare che un canale di comunicazione basato su protocollo HTTPS sia sicuro. Vedremo, infatti, come sia piuttosto semplice intercettare una comunicazione instaurata da un'applicazione mobile a meno che questa non implementi tale meccanismo di sicurezza.  
Quando un client si connette ad un server tramite protocollo HTTPS verifica che il certificato HTTPS, fornito dal server, sia valido per il dominio contattato. Per far ciò i dispositivi (mobile e desktop) hanno preinstallati una lista di certificati attendibili riconosciuti a livello mondiale. Un certificato, viene ritenuto valido, se fa parte della lista (CA), oppure se è stato firmato a sua volta con un certificato attendibile, quindi se è stato firmato da una CA, oppure se è stato autofirmato ed inserito nei certificati di autentiticità.  
Sull'APP all'interno dell'APK nel file res/xml/network-security-config.xml, dovrebbe essere presente l'hash della chiave pubblica del certificato con cui l'APP lato client prova a validare la chiave privata del server durante il TLS Handshake.  
Attraverso Frida, si cerca di mockare i controlli delle classi e funzioni che effettuano il certificate pinning (es. Android Library -  OkHttp with CertificatePinner class e IOS NSURLConnectionDelegate using NSURLConnection).

https://antreem.com/it/blog/certificate-pinning-aumentare-il-livello-di-sicurezza-delle-connessioni
Una volta stabilita l'associazione tra host e certificato, la relazione tra i due viene formalizzata, fissando il certificato a quell'host. Una connessione sicura con un client o una chiamata API viene approvata solo nei casi in cui il certificato offerto esiste all'interno di quel set di certificati aggiunti.

Posso usare pezzi di codice da iniettare nell'apk esistente per importare librerie di frida all'interno dell'APK, in modo da poter utilizzare objection e disabilitare il pinning dell'apk.

il pinning SSL è una tecnica implementata dalla maggior parte dei proprietari di applicazioni in modo che qualsiasi richiesta inviata dall'applicazione mobile non venga intercettata. Il pinning SSL è considerato il primo e il passo più importante nel meccanismo di sicurezza di un'applicazione. Ma a causa di mezzi impropri, il pinning SSL di solito può essere aggirato. Ancora una volta Frida e Objection sono i migliori strumenti che ci aiuteranno qui.

1. Client Hello
2. Server Hello with Server Certificate (public key)
3. Client: Calculate hashing + Check Matching Hashing + Pinning or Not (Match or not Match)




#. Root Detection:
il rooting è il processo che consente agli utenti del sistema operativo mobile Android di ottenere un controllo privilegiato (noto come accesso root) su vari sottosistemi Android. Non dovrebbe essere consentita l'esecuzione delle applicazioni su dispositivi rooted. E quindi proviamo vari Root Detection Bypass usando Frida e Objection .



#. Bypass accesso biometrico:
Agganciando e manomettendo alcune funzioni dell'applicazione in fase di esecuzione con il toolkit di strumentazione (come Frida), è possibile aggirare l'autenticazione biometrica a causa della debole implementazione della gestione delle credenziali.

Android:
Il "CryptoObject" non viene utilizzato nel metodo "autentica" della classe "BiometricPrompt". L'implementazione dell'autenticazione si basa sul callback "onAuthenticationSucceded" che viene chiamato e potrebbe essere aggirato utilizzando un cryptoObject NULL in tale funzione.



#. Request caching:
Come comportamento predefinito, diversi framework iOS e Android sono configurati per memorizzare nella cache le richieste/risposte HTTP. Quest'ultimo può includere informazioni sensibili in chiaro come le credenziali di accesso.
Nello specifico, l'app memorizza nella cache tutte le risposte inclusi i dati PII dell'utente come nome, cognome, email, numero di telefono, indirizzo, ecc.
Un utente malintenzionato con accesso a tali file può estrarre informazioni personali e altri dati relativi all'account.

Android example:
/data/data/{package.app.com}/cache/app_cache/*

iOS example:
/var/mobile/Containers/Data/Application/BEC86795-FBF4-454F-83E3-A2C00B6548FD/Library/Caches/{package.app.com}/Cache.db-wal




#. Plaintext SharedPreferences (/data/data/{ID}/shared_prefs/{FILE}.xml):
Il file SharedPreferences (archiviazione XML con struttura chiave/valore) include token di accesso e aggiornamento in testo normale, nonché token di memorizzazione e token biometrici.
Un utente malintenzionato con privilegi di root potrebbe accedere a questi dati ed eseguire ulteriori attacchi.

/data/data/com.example.app/shared_prefs/FlutterSharedPreferences.xml






#. WebView Debug Mode Enabled (marketwall 2021) (setWebContentsDebuggingEnabled):




#. Backup mode enabled:
Android esegue per impostazione predefinita un backup completo delle applicazioni, inclusi i file privati ​​archiviati nella partizione /data. L'attributoallowBackup, se non impostato, ha il vero valore predefinito. Il servizio Gestione backup carica tali dati sull'account Google Drive dell'utente.
Se l'applicazione contiene dati sensibili che non devono essere ripristinati, la modalità di backup può essere disabilitata impostando l'attributo "android:allowBackup" su false nel tag dell'applicazione: <application android:allowBackup="false">
Altrimenti fa sì che tutti i dati dell'applicazione vengano salvati utilizzando `adb`. Il valore predefinito di questo attributo è `"true`



# Debug Mode Enabled:



#. Task hijacking:
Task hijacking è una vulnerabilità che colpisce le applicazioni in esecuzione su dispositivi Android (<=10) a causa di un'errata configurazione nel file AndroidManifest.xml con le funzionalità di controllo delle attività.
Ciò potrebbe consentire agli aggressori/malware di prendere il controllo di app legittime, rubare i dati dell'utente ed eseguire una serie di attacchi.

Imposta "task affinity" delle attività dell'applicazione su "" (stringa vuota) nel tag <activity> di AndroidManifest.xml per forzare le attività a utilizzare un'affinità attività generata casualmente oppure impostala nel tag <application> su applicare su tutte le attività nell'applicazione.
Non specificare la modalità di avvio impostata su singleTask né aggiungere il supporto per un servizio di monitoraggio per rilevare la presenza di attività dannose in primo piano. Il problema è stato risolto da Android 11 e versioni successive.
Es. Task affinity not declared and activities launch mode is set to singleTask


#. Missing Code Obfuscation:




#. Attribute usesCleartextTraffic set to True:
L'attributo android:usesCleartextTraffic indica se l'app intende utilizzare il traffico di rete in chiaro, come HTTP in chiaro.
Il valore predefinito per le app destinate al livello API 27 o inferiore è "true". Le app destinate al livello API 28 o superiore hanno per impostazione predefinita "false"."



#. Hard-coded clear-text Cryptographic Secrets:






```

